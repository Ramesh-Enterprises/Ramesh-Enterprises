<!-- Chatbot Button & Popup -->
<style>
  #chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #ff9800;
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 30px;
    cursor: pointer;
    z-index: 999;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  #chat-popup {
    display: none;
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 320px;
    max-height: 400px;
    background: white;
    border: 2px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    z-index: 999;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  #chat-header {
    background: #ff9800;
    color: white;
    padding: 10px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    background: #fefefe;
  }

  #chat-input {
    border: none;
    border-top: 1px solid #ddd;
    padding: 10px;
    outline: none;
  }
</style>

<button id="chat-toggle">ðŸ’¬</button>
<div id="chat-popup">
  <div id="chat-header">
    RameshBot ðŸ¤–
    <button onclick="toggleChat()" style="background:none;border:none;color:white;font-size:16px;">âœ–</button>
  </div>
  <div id="chat-messages"></div>
  <input id="chat-input" type="text" placeholder="Type a message..." />
</div>

<script src="https://js.puter.com/v2/"></script>
<script>
  function toggleChat() {
    const popup = document.getElementById('chat-popup');
    popup.style.display = popup.style.display === 'flex' ? 'none' : 'flex';
  }
  document.getElementById('chat-toggle').onclick = toggleChat;

  async function initChat() {
    await puter.ai.ready;
    const chatInput = document.getElementById('chat-input');
    const messages = document.getElementById('chat-messages');

    function showMessage(sender, text) {
      const wrapper = document.createElement('div');
      wrapper.style.margin = '8px 0';
      wrapper.style.padding = '8px';
      wrapper.style.borderRadius = '8px';
      wrapper.style.background = sender === 'You' ? '#e1f5fe' : '#ffe0b2';
      wrapper.innerHTML = `<strong>${sender}:</strong> <span>${text}</span>`;
      messages.appendChild(wrapper);
      messages.scrollTop = messages.scrollHeight;
      return wrapper.querySelector('span');
    }

    const customResponses = {
      'hello': "Hello! Welcome to Ramesh Enterprisesâ„¢. How can I assist you today?",
      'menu': "We offer dosas, biryani, lassi, jalebi and more! Want the full menu?",
      'order': "To place an order, visit our products section or call us at 99785-RAMESH.",
      'contact': "You can find us at Ramesh Enterprises, Chitapalli Road."
    };

    chatInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter' && chatInput.value.trim()) {
        const userText = chatInput.value.trim();
        showMessage('You', userText);
        chatInput.value = '';

        const botSpan = showMessage('RameshBot ðŸ¤–', 'Typing...');

        let reply = Object.keys(customResponses).find(k => userText.toLowerCase().includes(k));

        if (reply) {
          let res = customResponses[reply];
          let i = 0;
          const typingInterval = setInterval(() => {
            if (i <= res.length) {
              botSpan.textContent = res.slice(0, i);
              i++;
            } else {
              clearInterval(typingInterval);
            }
          }, 30);
        } else {
          const aiRes = await puter.ai.chat(userText);
          let i = 0;
          const typingInterval = setInterval(() => {
            if (i <= aiRes.length) {
              botSpan.textContent = aiRes.slice(0, i);
              i++;
            } else {
              clearInterval(typingInterval);
            }
          }, 30);
        }
      }
    });
  }
  initChat();
</script>
